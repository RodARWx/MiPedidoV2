<!DOCTYPE html>
<html lang="es"
      xmlns:th="http://www.thymeleaf.org">
    <head>
        <meta charset="UTF-8">
        <title>Nuevo Pedido</title>

        <!-- Bootstrap -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
              rel="stylesheet">
    </head>

    <body class="bg-light">

        <div class="container mt-4">

            <h2 class="mb-4">Nuevo Pedido</h2>

            <!-- Mensaje de error -->
            <div th:if="${error}" class="alert alert-danger">
                <span th:text="${error}"></span>
            </div>

            <div class="card">
                <div class="card-body">

                    <form th:action="@{/guardar_pedido}"
                          th:object="${pedido}"
                          method="post">

                        <!-- Cliente -->
                        <div class="mb-3">
                            <label class="form-label">Nombre del cliente</label>
                            <input type="text"
                                   th:field="*{cliente}"
                                   class="form-control"
                                   placeholder="Ej: Juan Pérez"
                                   required>
                        </div>

                        <!-- Tipo de pedido -->
                        <div class="mb-3">
                            <label class="form-label">Tipo de pedido</label>
                            <select th:field="*{tipoPedido}"
                                    class="form-select"
                                    id="tipoPedido"
                                    required>
                                <option value="">Seleccione una opción</option>
                                <option value="MESA">En mesa</option>
                                <option value="PARA_LLEVAR">Para llevar</option>
                            </select>
                        </div>

                        <!-- Mesa -->
                        <div class="mb-3" id="mesaContainer">
                            <label class="form-label">Mesa</label>

                            <select name="mesa.idMesa"
                                    class="form-select"
                                    id="mesaSelect">

                                <option value="">Seleccione una mesa</option>

                                <option th:each="m : ${mesasLibres}"
                                        th:value="${m.idMesa}"
                                        th:text="'Mesa ' + ${m.numero}">
                                </option>
                            </select>

                            <div class="form-text"
                                 th:if="${mesasLibres.isEmpty()}">
                                No hay mesas disponibles en este momento
                            </div>
                        </div>

                        <!-- Botones -->
                        <div class="d-flex justify-content-between mt-4">
                            <a href="/pedidos" class="btn btn-secondary">
                                Cancelar
                            </a>

                            <button type="submit"
                                    class="btn btn-primary"
                                    id="btnCrear">
                                Crear pedido
                            </button>
                        </div>

                    </form>

                </div>
            </div>

        </div>

        <!-- JS mínimo para UX -->
        <script>
            const tipoPedido = document.getElementById('tipoPedido');
            const mesaContainer = document.getElementById('mesaContainer');
            const mesaSelect = document.getElementById('mesaSelect');

            function actualizarVistaMesa() {
                if (tipoPedido.value === 'PARA_LLEVAR') {
                    mesaContainer.style.display = 'none';
                    mesaSelect.value = '';
                    mesaSelect.disabled = true;
                } else {
                    mesaContainer.style.display = 'block';
                    mesaSelect.disabled = false;
                }
            }

            tipoPedido.addEventListener('change', actualizarVistaMesa);

            // Estado inicial
            actualizarVistaMesa();
        </script>

    </body>
</html>
